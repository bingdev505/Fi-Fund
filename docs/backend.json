{
  "entities": {
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents a source of income for the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the income entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who owns this income entry. (Relationship: User 1:N Income)"
        },
        "amount": {
          "type": "number",
          "description": "The amount of income received."
        },
        "category": {
          "type": "string",
          "description": "The category of income (e.g., salary, investment).",
          "format": "string"
        },
        "date": {
          "type": "string",
          "description": "The date the income was received.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the income source."
        }
      },
      "required": [
        "id",
        "userId",
        "amount",
        "category",
        "date"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense incurred by the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who owns this expense entry. (Relationship: User 1:N Expense)"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the expense."
        },
        "category": {
          "type": "string",
          "description": "The category of the expense (e.g., food, rent).",
          "format": "string"
        },
        "date": {
          "type": "string",
          "description": "The date the expense was incurred.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the expense."
        }
      },
      "required": [
        "id",
        "userId",
        "amount",
        "category",
        "date"
      ]
    },
    "Creditor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Creditor",
      "type": "object",
      "description": "Represents a person or entity to whom the user owes money.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the creditor."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who owes this debt. (Relationship: User 1:N Creditor)"
        },
        "name": {
          "type": "string",
          "description": "The name of the creditor."
        },
        "amountOwed": {
          "type": "number",
          "description": "The amount of money owed to the creditor."
        },
        "dueDate": {
          "type": "string",
          "description": "The date by which the debt is due.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the debt."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "amountOwed",
        "dueDate"
      ]
    },
    "Debtor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Debtor",
      "type": "object",
      "description": "Represents a person or entity who owes money to the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the debtor."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who is owed this debt. (Relationship: User 1:N Debtor)"
        },
        "name": {
          "type": "string",
          "description": "The name of the debtor."
        },
        "amountOwed": {
          "type": "number",
          "description": "The amount of money owed by the debtor."
        },
        "dueDate": {
          "type": "string",
          "description": "The date by which the debt is due.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the debt."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "amountOwed",
        "dueDate"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "The name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. User ID is used for authentication and path-based authorization.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/incomes/{incomeId}",
        "definition": {
          "entityName": "Income",
          "schema": {
            "$ref": "#/backend/entities/Income"
          },
          "description": "Stores income records for each user. Path-based ownership ensures that only the user can access their income records.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "incomeId",
              "description": "The unique identifier of the income record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense records for each user. Path-based ownership ensures that only the user can access their expense records.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "expenseId",
              "description": "The unique identifier of the expense record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/creditors/{creditorId}",
        "definition": {
          "entityName": "Creditor",
          "schema": {
            "$ref": "#/backend/entities/Creditor"
          },
          "description": "Stores creditor records (debts owed to others) for each user. Path-based ownership ensures that only the user can access their creditor records.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "creditorId",
              "description": "The unique identifier of the creditor record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/debtors/{debtorId}",
        "definition": {
          "entityName": "Debtor",
          "schema": {
            "$ref": "#/backend/entities/Debtor"
          },
          "description": "Stores debtor records (debts owed to the user) for each user. Path-based ownership ensures that only the user can access their debtor records.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "debtorId",
              "description": "The unique identifier of the debtor record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to provide a secure and scalable solution for the FinanceFlow AI application. It leverages path-based ownership for user-specific data like income, expenses, creditors, and debtors, ensuring that only the authenticated user can access their own financial records. This approach greatly simplifies security rules.  Authorization Independence is achieved by avoiding `get()` calls in rules, as each entity is stored under the respective user's path. QAPs (Rules are not Filters) are supported by the path-based structure, which enables efficient list operations without needing to filter based on document content, enhancing security and performance.  The structure enforces invariants by clearly defining ownership through the user ID in the path."
  }
}